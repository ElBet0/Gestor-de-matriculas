#Inserts fijos:

#INSERTS FIJOS
insert into RM_FAMILIA(APELLIDO_PATERNO,APELLIDO_MATERNO,NUM_TELF,CORREO_ELECTRONICO,DIRECCION,ACTIVO) VALUES ('Del Rio','Laos','956721752','a20230343@gmail.com','Por la Brasil',1);
insert into RM_ALUMNO (DNI,NOMBRE,FECHA_NACIMIENTO,FECHA_INGRESO,SEXO,RELIGION,PENSION_BASE,ACTIVO,FAMILIA_ID) VALUES (72181460,'Humberto',sysdate(),sysdate(),'M','Ateo',100,1,60);
INSERT INTO RM_CARGO (NOMBRE, ACTIVO) VALUES ('ADMINISTRATIVO', 1);
INSERT INTO RM_PERSONAL (
ACTIVO,
NOMBRE,
APELLIDO_PATERNO,
APELLIDO_MATERNO,
CORREO_ELECTRONICO,
TELEFONO,
DNI,
SALARIO,
FECHA_CONTRATACION,
FIN_FECHA_CONTRATO,
TIPO_CONTRATO,
ID_CARGO
)
VALUES (
1,
'María',
'Gonzales',
'Paredes',
'maria.gonzales@colegio.edu',
'987654321',
45678912,
3500.00,
'2024-01-10',
'2025-01-10',
'COMPLETO',
1
);
INSERT INTO RM_PERIODO_ACADEMICO (
NOMBRE,
DESCRIPCION,
FECHA_INICIO,
FECHA_FIN,
ACTIVO
)
VALUES (
'2025',
'Primer semestre académico 2025',
'2025-03-01',
'2025-12-30',
1
);
insert into RM_GRADO_ACADEMICO(NOMBRE,ABREVIATURA,ACTIVO) VALUES('1RO SEC','SEC',1);
insert into RM_AULA (NOMBRE,GRADO_ACADEMICO_ID,ACTIVO) values('PATITO',11,1);
SET SQL_SAFE_UPDATES = 0;
INSERT INTO RM_USUARIO (NOMBRE, SALT, ITERACION, CLAVE_HASH, ACTIVO,ROL,ULTIMO_ACCESO)
VALUES (
'Joaquin',
'ASNFZ4mrze8QMlR2mLrc/g==',
10000,
'xHVdin4lE7fMT7lk13glkDvK1ai5Xm0OyUUdbSmUcf0=',
1,
'PERSONAL_ADMINISTRATIVO',
sysdate()
);
select * from RM_USUARIO;
INSERT INTO RM_USUARIO (NOMBRE, SALT, ITERACION, CLAVE_HASH, ACTIVO,ROL,ULTIMO_ACCESO)
VALUES (
'DeLrIo1020',
'/ty6mHZUMhDvzauJZ0UjAQ==',
10000,
'yENl2BjrPlJyWS0DlUzp/EBEENlAgSsUskxTU/AATUM=',
1,
'DIRECTOR',
sysdate()
);

select *from RM_PERIODOxAULA;
select *from RM_PERIODO_ACADEMICO;


INSERT INTO RM_TIPO_DEUDA(DESCRIPCION,MONTO_GENERAL,ACTIVO)
VALUES ('MATRICULA', 100, 1);

CREATE PROCEDURE LISTAR_AULA_ASIGNAR_MATR()
BEGIN
SELECT
a.nombre as aula_nombre,
g.nombre as grado_nombre,
per.vacantes_disponibles,
per.periodo_aula_id
FROM RM_PERIODOxAULA per
join RM_AULA a on a.ID_AULA=per.ID_AULA
join RM_PERIODO_ACADEMICO p on p.PERIODO_ACADEMICO_ID=per.PERIODO_ACADEMICO_ID
join RM_GRADO_ACADEMICO g on g.GRADO_ACADEMICO_ID=a.GRADO_ACADEMICO_ID
WHERE per.activo=1 and p.activo=1 and g.activo=1 and a.activo=1;
END

#Trigger Fijo:
CREATE TRIGGER TRG_AFTER_INSERT_MATRICULA_DEUDA
AFTER INSERT ON RM_MATRICULA
FOR EACH ROW
BEGIN
DECLARE v_id_tipo_deuda INT;
DECLARE v_monto DECIMAL(10,2);

-- Obtener el tipo de deuda "MATRICULA"
SELECT ID_TIPO_DEUDA, MONTO_GENERAL
INTO v_id_tipo_deuda, v_monto
FROM RM_TIPO_DEUDA
WHERE DESCRIPCION = 'MATRICULA'
AND ACTIVO = 1
LIMIT 1;

IF v_id_tipo_deuda IS NULL THEN
SIGNAL SQLSTATE '45000'
SET MESSAGE_TEXT = 'No existe un TIPO_DEUDA activo para MATRÍCULA.';
END IF;

-- Insertar deuda automáticamente
INSERT INTO RM_DEUDA(
MONTO,
ID_TIPO_DEUDA,
FECHA_EMISION,
FECHA_VENCIMIENTO,
DESCRIPCION,
DESCUENTO,
ALUMNO_ID,
ACTIVO
)
VALUES (
v_monto,
v_id_tipo_deuda,
CURDATE(),
DATE_ADD(CURDATE(), INTERVAL 30 DAY),
'Matrícula del periodo',
0,
NEW.ALUMNO_ID,
1
);

END¡¡
DELIMITER ;
